git:
  parseEmoji: true
gui:
  language: "ja"
  nerdFontsVersion: "3"
os:
  editPreset: "nvim"
customCommands:
  - key: "<c-z>"
    context: "global"
    description: "直前のマージを安全に取り消す（未コミット変更の保護付き）"
    prompts:
      - type: "confirm"
        title: "マージの取り消し（Safe Undo）"
        body: "直前のマージ操作を無かったことにしますか？\n（作業中の未コミットファイルは安全に保護されます）"
    command: |
      git_dir="$(git rev-parse --git-dir)"
      if [ -f "$git_dir/MERGE_HEAD" ]; then
        # パターンA: コンフリクト等でマージが途中で止まっている場合
        git merge --abort
      else
        # パターンB: マージが完了して履歴に残ってしまった場合
        # --keep オプションを使うことで、未コミットの変更を保護しつつリセットします
        git reset --keep ORIG_HEAD
      fi

  - key: "M"
    context: "localBranches"
    description: "マージメニュー（未コミット変更のガード付き）"
    prompts:
      - type: "menu"
        title: "マージ手法を選択 (未コミットガード付き)"
        key: "MergeOption"
        options:
          - name: "通常のマージ"
            description: "選択したブランチを現在のブランチにマージします"
            value: "merge"
          - name: "スカッシュマージ（未コミット）"
            description: "変更をステージングに乗せた状態で止めます"
            value: "squash"
          - name: "スカッシュマージ（コミット）"
            description: "スカッシュマージ後、自動メッセージでコミットします"
            value: "squash_commit"
    command: |
      if ! git diff-index --quiet HEAD --; then
        echo "【警告】作業中のファイルが存在するため、マージを中止しました。"
        exit 1
      fi

      if [ "{{.Form.MergeOption}}" = "merge" ]; then
        git merge {{.SelectedLocalBranch.Name}}
      elif [ "{{.Form.MergeOption}}" = "squash" ]; then
        git merge --squash {{.SelectedLocalBranch.Name}}
      elif [ "{{.Form.MergeOption}}" = "squash_commit" ]; then
        git merge --squash {{.SelectedLocalBranch.Name}} && git commit -m "Squash merge {{.SelectedLocalBranch.Name}} into $(git branch --show-current)"
      fi
  - key: "c"
    context: "files"
    description: "commit files with format"
    prompts:
      - type: "menu"
        title: "What kind of commit type is it?"
        key: "Type"
        options:
          - name: "fix"
            description: "\U0001F41B バグや不具合の修正"
            value: "fix :bug:"
          - name: "hotfix"
            description: "\U0001F691 緊急のバグや不具合の修正"
            value: "hotfix :ambulance:"
          - name: "feat"
            description: "✨ 新機能の追加"
            value: "feat :sparkles:"
          - name: "update"
            description: "⬆️  既存機能に問題ないが処理の更新や改善"
            value: "update :arrow_up:"
          - name: "change"
            description: "\U0001F4AB 仕様変更による更新や改善"
            value: "change :dizzy:"
          - name: "docs"
            description: "\U0001F4DD ドキュメントの更新や改善"
            value: "docs :memo:"
          - name: "style"
            description: "\U0001F3A8 コードフォーマットの修正、UIのみの変更"
            value: "style :art:"
          - name: "refactor"
            description: "♻️  パフォーマンスの改善なしのコードの改善"
            value: "refactor :recycle:"
          - name: "rename"
            description: "✏️  ディレクトリ・ファイル名の変更"
            value: "rename :pencil2:"
          - name: "perf"
            description: "\U0001F680 パフォーマンス改善"
            value: "perf :rocket:"
          - name: "move"
            description: "\U0001F69A ディレクトリ・ファイルの移動"
            value: "move :truck:"
          - name: "delete"
            description: "\U0001F525 ファイルやディレクトリの削除"
            value: "delete :fire:"
          - name: "upgrade"
            description: "\U0001F31F バージョン更新"
            value: "upgrade :star2:"
          - name: "test"
            description: "\U0001F49A テスト・CIの追加や改善"
            value: "test :green_heart:"
          - name: "chore"
            description: "\U0001F527 設定ファイルの変更や改善"
            value: "chore :wrench:"
          - name: "wip"
            description: "\U0001F6A7 作業中"
            value: "wip :construction:"
      - type: "input"
        title: "Enter the Message"
        key: "Message"
        initialValue: ""
      - type: "confirm"
        title: "Commit"
        body: "Commit with the message '{{.Form.Type}} {{.Form.Message}}'. Is this okay?"
    command: >
      bash -c 'type="{{.Form.Type}}"; message="{{.Form.Message}}"; commit_message="$type $message"; git commit -m "$commit_message"'

    loadingText: "Committing..."
keybinding:
  files:
    commitChanges: "<c-c>"
